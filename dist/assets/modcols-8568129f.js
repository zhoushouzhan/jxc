import{r as v,a as D,Z as L,w as M,o as q,g as J,_ as $,b as z,d as p,e as g,i as l,j as a,F as y,q as N,t as h,l as A,v as G,f as K,K as P,y as C,E as U}from"./index-ddd32adc.js";import W from"./editcol-a80eb43b.js";const k=v([]),_=D(0),c=v([]);L.post("/cols",{limit:300}).then(e=>{Object.keys(e.data.data).map(t=>{k.push(e.data.data[t])})});v([]);const n=v({el:null,posindex:0,getparent:(e,t)=>{if(e.className.indexOf(t)>=0)return e;for(;e&&(e=e.parentNode);)if(e.className&&e.className.indexOf(t)>=0)return e},elindex:e=>{var t=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)t++;return t},animate:(e,t)=>{var s=300;{var o=t.getBoundingClientRect();n.css(t,"transition","none"),n.css(t,"transform","translate3d("+(e.left-o.left)+"px,"+(e.top-o.top)+"px,0)"),t.offsetWidth,n.css(t,"transition","all "+s+"ms"),n.css(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=setTimeout(function(){n.css(t,"transition",""),n.css(t,"transform",""),t.animated=!1},s)}},css:(e,t,s)=>{var o=e&&e.style;if(o){if(s===void 0)return document.defaultView&&document.defaultView.getComputedStyle?s=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(s=e.currentStyle),t===void 0?s:s[t];t in o||(t="-webkit-"+t),o[t]=s+(typeof s=="string"?"":"px")}},resort:()=>{var e=document.querySelector("#col").children,t=[];for(let o=0;o<e.length;o++){var s=e[o].getAttribute("index");t[s]=e[o]}for(let o=0;o<t.length;o++)t[o]&&(t[o].innerText=t[o].getAttribute("col"),document.getElementById("col").appendChild(t[o]))}}),S=e=>{e.target.parentNode.className.indexOf("list")>=0?(n.el=e.target.cloneNode(!0),n.el.setAttribute("isAdd","1")):(n.el=e.target,console.log("moveCol"))},j=e=>{if(n.el===null)return;let t=e.target;if(t.className.indexOf("column")>=0&&t.children.length==0){t.appendChild(n.el);return}if(t.getAttribute("col")&&t!=n.el&&n.getparent(t,"column")){let s=t.getBoundingClientRect(),o=n.el.getBoundingClientRect();if(t&&t.animated)return;n.posindex=n.elindex(t),n.elindex(n.el)<n.posindex?t.parentNode.insertBefore(n.el,t.nextSibling):t.parentNode.insertBefore(n.el,t),n.animate(o,n.el),n.animate(s,t)}},I=e=>{if(n.el===null)return;let t=n.getparent(e.target,"column"),s=t.getAttribute("index");s=parseInt(s),n.el.getAttribute("isAdd")&&k.map(o=>{if(o.id==n.el.id){let m=JSON.parse(JSON.stringify(o));m.groupindex=s,m.id=new Date().getTime(),m.sort=n.posindex,c.push(m)}});for(let o in t.children)if(t.children[o].nodeType===1){t.children[o].getAttribute("isAdd")&&t.children[o].remove();let m=s+parseInt(o);c.map(x=>{t.children[o]&&t.children[o].getAttribute("id")==x.id&&(x.sort=m,x.groupindex=s)})}},V=e=>{n.getparent(e.target,"list");let t=n.el.getAttribute("id");c.forEach((s,o)=>{s.id==t&&c.splice(o,1)})},E=e=>{},T=e=>{},R=e=>{var t=e.target.children;if(t)for(var s=0;s<t.length;s++)t[s].ondblclick=o=>{_.value=o.target.getAttribute("id")?o.target.getAttribute("id"):o.target.parentNode.getAttribute("id")}},Z={class:"bg-white flex flex-wrap divide-x"},H={class:"w-40"},Q=l("div",{class:"p-2 bg-gray-700 text-white font-bold"},"字段列表",-1),X=["id","index","col"],Y={class:"relative"},tt={class:"flex justify-between divide-x"},et={class:"font-bold bg-amber-900 text-white p-2"},ot=["index"],nt=["id","index","col"],st={class:"text-gray-400 font-thin font-mono"},it={class:"flex-1 w-[500px]"},at=l("div",{class:"p-2 bg-gray-400 text-white font-bold text-center"},"表单预览",-1),rt={class:"p-2"},dt={class:"p-1"},lt={key:0,class:"top-0 left-0 absolute bg-black w-full h-full z-10 bg-opacity-50"},mt={__name:"modcols",props:{modName:null},emits:["jumpCom"],setup(e,{emit:t}){const s=e,o=v({}),m=D(0),x=v({}),w=D(""),B=v({data:[]});M(_,(u,i)=>{u&&Object.keys(c).map(r=>{c[r].id==u&&(B.data=c[r])}),c.sort((r,d)=>r.sort-d.sort)});const F=async()=>{let u=[],i=0;if(c.map(r=>{u.indexOf(r.name)>=0&&(C({type:"alter-error",text:"有重复字段"+r.name}),i=1),u.push(r.name)}),!i){m.value=0;const r=await U("/mod/updateCol",{id:x.id,modcolumn:c});r.code?(C({type:"alter-success",text:r.msg}),m.value=1):C({type:"alter-error",text:r.msg})}};return q(async()=>{const u=await J("/mod/getmod",{name:s.modName});Object.keys(u.data).map(i=>{x[i]=u.data[i]}),w.value=u.data.colgroup,u.data.modcolumn&&(u.data.modcolumn.map(i=>{c.push(i)}),c.sort((i,r)=>i.sort-r.sort)),m.value=1}),$(()=>{c.length=0}),(u,i)=>{const r=z("ypform");return p(),g("div",{class:"m-3 text-sm select-none h-full relative",onDragstart:i[6]||(i[6]=(...d)=>a(S)&&a(S)(...d)),onDragover:i[7]||(i[7]=P((...d)=>a(j)&&a(j)(...d),["prevent"]))},[l("div",Z,[l("div",H,[Q,l("div",{class:"list divide-y h-[550px] overflow-y-auto",id:"col",onDrop:i[0]||(i[0]=(...d)=>a(V)&&a(V)(...d)),onDragend:i[1]||(i[1]=(...d)=>a(E)&&a(E)(...d))},[(p(!0),g(y,null,N(a(k),(d,b)=>(p(),g("div",{draggable:"true",class:"p-2",id:d.id,index:b+1,col:d.alias,key:b},h(d.alias),9,X))),128))],32)]),l("div",Y,[l("div",tt,[(p(!0),g(y,null,N(w.value,(d,b)=>(p(),g("div",{key:b,class:"w-52"},[l("div",et,h(d),1),l("div",{class:"column h-[550px] overflow-y-auto text-red-900 font-bold divide-y",index:b,onDrop:i[2]||(i[2]=(...f)=>a(I)&&a(I)(...f)),onDragenter:i[3]||(i[3]=(...f)=>a(T)&&a(T)(...f)),onMouseenter:i[4]||(i[4]=(...f)=>a(R)&&a(R)(...f))},[(p(!0),g(y,null,N(a(c),(f,O)=>(p(),g(y,{key:O},[f.groupindex==b?(p(),g("div",{key:0,draggable:"true",class:"p-2 flex justify-between",id:f.id,index:O+1,col:f.alias},[l("div",null,h(f.alias),1),l("div",st,h(f.name),1)],8,nt)):A("",!0)],64))),128))],40,ot)]))),128))])]),l("div",it,[at,l("div",rt,[l("div",dt,[m.value?(p(),G(r,{key:0,formData:o,group:w.value,mod:x,isPreview:1},null,8,["formData","group","mod"])):A("",!0)])])])]),l("div",{class:"py-2 text-center"},[l("button",{type:"button",class:"yp-button rounded",onClick:F},"提交")]),a(_)?(p(),g("div",lt,[K(W,{col:B.data,onComplete:i[5]||(i[5]=d=>_.value=0)},null,8,["col"])])):A("",!0)],32)}}};export{mt as default};
