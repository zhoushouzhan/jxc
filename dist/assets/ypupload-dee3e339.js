import{M as p,o as l,y as u,d as c,e as m,a2 as y,B as f}from"./index-169137c2.js";import{p as _}from"./plupload.full.min-8c5cddee.js";const b={id:"plupload"},z={__name:"ypupload",emits:["getlist"],setup(x,{expose:n,emit:F}){const o=f("uploadHandle"),t=new _.Uploader({url:"/index/upload",headers:{Authorization:p.state.User.token,"x-requested-with":"XMLHttpRequest"}});return n({onupload:()=>{t.start()},removeFile:s=>{t.removeFile(s),o.removeFile(s)}}),l(()=>{t.setOption("browse_button","ypupload"),t.setOption("filters",{mime_types:[{title:"Files",extensions:p.state.Sys.sysinfo.filetype}],max_file_size:p.state.Sys.sysinfo.uploadsize+"mb",prevent_duplicates:!0}),t.init(),t.bind("FilesAdded",(s,i)=>{i.map((e,a)=>{let d="";e.type.indexOf("application")<0&&(d=URL.createObjectURL(e.getNative()));let r={};r.id=e.id,r.name=e.name,r.type=e.type,r.size=parseInt(e.origSize/1024/1024*100)/100,r.progress=0,r.status=0,r.src=d,o.addFile(r)})}),t.bind("BeforeUpload",(s,i)=>{o.readyList=o.readyList.map((e,a)=>(e.id==i.id&&(e.status=1),e))}),t.bind("UploadProgress",(s,i)=>{o.readyList=o.readyList.map((e,a)=>(e.id==i.id&&(e.progress=i.percent),e))}),t.bind("FileUploaded",(s,i,e)=>{let a=JSON.parse(e.response);o.readyList=o.readyList.map((d,r)=>(d.id==i.id&&(a.code==1?(d.status=2,d.src=a.data.url):d.status=3),d))}),t.bind("UploadComplete",(s,i)=>{u({type:"alter-success",text:"上传完毕"}),s.splice(),o.reload()}),t.bind("FilesAdded",(s,i)=>{}),t.bind("Error",(s,i)=>{console.log("error")})}),(s,i)=>(c(),m("div",b,[y(s.$slots,"default")]))}};export{z as default};
