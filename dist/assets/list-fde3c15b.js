import{u as ut,a as pt,r as u,w as gt,o as mt,b as f,c as J,d as n,v as yt,h as F,i as t,t as c,f as p,M as K,e as i,k as y,l as r,m as k,F as R,q as S,n as _t,y as w,z as A,E as ht,g as I,A as bt,D as M}from"./index-ddd32adc.js";const vt={class:"flex items-center"},xt=t("i",{class:"ri-2x text-gray-500 ml-2 ri-product-hunt-line"},null,-1),ft={class:"text-xl px-2"},kt=t("div",{class:"text-gray-400"},null,-1),wt={class:"flex items-center space-x-2"},Vt=t("div",{class:"flex-1"},null,-1),Ct={class:"flex items-center space-x-3"},Lt=t("i",{class:"ri-add-line ri-lg pr-1"},null,-1),Ot=t("i",{class:"ri-download-2-fill ri-lg pr-1"},null,-1),Ut=t("i",{class:"ri-upload-2-fill ri-lg pr-1"},null,-1),Dt=t("i",{class:"ri-barcode-line ri-lg pr-1"},null,-1),It={class:"yp-table-datalist text-hui-300"},Tt=t("th",null,"序号",-1),jt=t("th",{class:"w-28"},"图片",-1),Rt=t("th",null,"名称",-1),St=t("th",null,"类别",-1),Bt=t("th",null,"金属",-1),Nt=t("th",null,"原石",-1),Et={class:"flex items-center space-x-1"},$t=t("div",null,"零售价",-1),Pt={key:0,class:"ri-menu-line text-gray-500"},zt={key:1,class:"ri-menu-line text-gray-500"},Jt={key:2,class:"ri-sort-desc text-gray-500"},Ft={key:3,class:"ri-sort-asc text-gray-500"},Kt=t("th",null,"标签价",-1),At={class:"flex items-center space-x-1"},Mt=t("div",null,"库存",-1),qt={key:0,class:"ri-menu-line text-gray-500"},Gt={key:1,class:"ri-menu-line text-gray-500"},Ht={key:2,class:"ri-sort-desc text-gray-500"},Qt={key:3,class:"ri-sort-asc text-gray-500"},Wt=t("th",null,"条码",-1),Xt=t("th",null,"标签",-1),Yt=t("th",null,"操作",-1),Zt=["src"],te=["onClick"],ee={class:"flex space-x-1 items-center"},oe={class:"p-2"},se={key:0},ae={__name:"list",props:{page:{default:0}},emits:["jumpTo"],setup(q,{emit:G}){const B=q,L=G,H=ut().meta,N=pt(!1),E=u([]),d=u({pagelimit:30,totalRecords:0,pageCount:0,currentPage:B.page}),Q=e=>d.totalRecords-(e+(d.currentPage-1)*d.pagelimit),W=e=>{l.page=e,d.currentPage=e,m()},a=u([]),_=u(JSON.parse(sessionStorage.getItem("printBarcode"))||[]),h=u(JSON.parse(sessionStorage.getItem("ingodownList"))||[]),b=u([]);gt(b,(e,o)=>{a.length=0,e.length>0?O.forEach(v=>{a.push(v.id)}):a.length=0});const l=u({orderby:"",ordersort:"",category_id:0,page:B.page,stone:0,code:"",keyword:"",label:""}),O=u([]),X=()=>{L("jumpTo",{to:"add",page:l.page})},Y=e=>{L("jumpTo",{to:"edit",id:e,page:l.page})},Z=()=>{L("jumpTo",{to:"barcode"})},tt=async e=>{if(a.length==0){w({type:"alter-error",text:"请选择条目"});return}A({text:"确认删除吗？"}).then(async()=>{const o=await ht("goods/delete",{id:a});o.code==1&&(w({type:"alter-success",text:o.msg}),a.length=0,b.length=0,m())}).catch(o=>{})},et=()=>{if(a.length==0){w({type:"alter-error",text:"请选择要打印的商品"});return}for(let e=0;e<a.length;e++)_.indexOf(a[e])<0?_.push(a[e]):_.splice(_.indexOf(a[e]),1);sessionStorage.setItem("printBarcode",JSON.stringify(_)),w({type:"alter-success",text:"己加入打印队列"})},ot=()=>{if(a.length==0){w({type:"alter-error",text:"请选择要打印的商品"});return}for(let e=0;e<a.length;e++)h.indexOf(a[e])<0?h.push(a[e]):h.splice(h.indexOf(a[e]),1);sessionStorage.setItem("ingodownList",JSON.stringify(h)),w({type:"alter-success",text:"添加入库队列成功"})},m=async()=>{let e=await I("/goods",l);if(e.code==1){d.currentPage=e.data.current_page,d.pageCount=e.data.last_page,d.totalRecords=e.data.total,d.pagelimit=e.data.per_page,O.length=0;for(let o in e.data.data)O.push(e.data.data[o])}},st=async()=>{const e=await I("godown/index");if(e.code==1)for(let o in e.data.data)E.push(e.data.data[o])},lt=()=>{l.page=0,d.currentPage=0,m()},$=e=>{l.page=0,l.orderby=e,l.ordersort=l.ordersort=="desc"?"asc":"desc",m()},P=e=>{const o=H.mod.name;return bt(o).indexOf(e)>=0},nt=async()=>{A({text:"确定导出吗？"}).then(async()=>{let e=[];a.length?e=await M("goods/export",{ids:a}):e=await M("goods/export",l);let o=new Blob([e.data]),v=e.headers["content-disposition"],U=new RegExp("filename=([^;]+\\.[^\\.;]+);*").exec(v),V=decodeURI(U[1]),g=document.createElement("a"),D=window.URL.createObjectURL(o);g.style.display="none",g.href=D,g.download=V,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(D)}).catch(e=>{console.log("no",e)})},z=u([]),at=async()=>{const e=await I("/classify/index",{pid:3428});e.code==1&&Object.keys(e.data).map(o=>{z[o]={id:e.data[o].id,title:e.data[o].title}})},T=u([]),it=async()=>{const e=await I("category/readTree");e.code==1&&(T.length=0,Object.keys(e.data).map(o=>{T.push(e.data[o])}))};return mt(async()=>{await at(),await m(),await it(),await st(),document.addEventListener("click",()=>{}),N.value=!0}),(e,o)=>{const v=f("yptree"),j=f("ypselect"),U=f("ypinput"),V=f("ypcheckbox"),g=f("yppage"),D=f("yplayout"),C=J("tooltip"),rt=J("viewer");return N.value?(n(),yt(D,{key:0},{header:F(s=>[t("div",vt,[xt,t("div",ft,c(s.meta.title),1),kt])]),list:F(()=>[t("div",wt,[t("div",null,[p(v,{modelValue:l.category_id,"onUpdate:modelValue":o[0]||(o[0]=s=>l.category_id=s),itemList:T,defaultTitle:"--选择栏目--"},null,8,["modelValue","itemList"])]),t("div",null,[p(j,{modelValue:l.stone,"onUpdate:modelValue":o[1]||(o[1]=s=>l.stone=s),itemList:z,defaultTitle:"--选择原石--"},null,8,["modelValue","itemList"])]),t("div",null,[p(U,{modelValue:l.keyword,"onUpdate:modelValue":o[2]||(o[2]=s=>l.keyword=s),placeholder:"条码|名称",onKeyup:K(m,["enter"])},null,8,["modelValue"])]),t("div",null,[p(U,{modelValue:l.label,"onUpdate:modelValue":o[3]||(o[3]=s=>l.label=s),placeholder:"标签",onKeyup:K(m,["enter"])},null,8,["modelValue"])]),t("div",null,[p(j,{modelValue:l.godown_id,"onUpdate:modelValue":o[4]||(o[4]=s=>l.godown_id=s),itemList:E,defaultTitle:"--所有仓库--"},null,8,["modelValue","itemList"])]),t("div",null,[t("button",{class:"btn btn-chen",onClick:lt},"查询")]),Vt,t("div",Ct,[P("add")?(n(),i("button",{key:0,class:"btn btn-hong",type:"button",onClick:X},[Lt,y(" 录入商品 ")])):r("",!0),t("button",{class:"btn btn-lan",onClick:o[5]||(o[5]=s=>L("jumpTo",{to:"import"}))},[Ot,y(" 导入商品 ")]),t("button",{class:"btn btn-lv",onClick:nt},[Ut,y(" 导出 ")]),t("button",{class:"btn btn-zi",onClick:Z},[Dt,y(" 打印条码 ")])])]),t("div",null,[t("table",It,[t("thead",null,[t("tr",null,[t("th",null,[k(p(V,{value:"all",modelValue:b,"onUpdate:modelValue":o[6]||(o[6]=s=>b=s)},null,8,["modelValue"]),[[C,"全选",void 0,{top:!0}]])]),Tt,jt,Rt,St,Bt,Nt,t("th",null,[t("div",Et,[$t,t("div",{class:"cursor-pointer",onClick:o[7]||(o[7]=s=>$("storeprice"))},[l.orderby!="storeprice"?(n(),i("i",Pt)):r("",!0),l.orderby=="storeprice"&&l.ordersort==""?(n(),i("i",zt)):r("",!0),l.orderby=="storeprice"&&l.ordersort=="desc"?(n(),i("i",Jt)):r("",!0),l.orderby=="storeprice"&&l.ordersort=="asc"?(n(),i("i",Ft)):r("",!0)])])]),Kt,t("th",null,[t("div",At,[Mt,t("div",{class:"cursor-pointer",onClick:o[8]||(o[8]=s=>$("stock"))},[l.orderby!="stock"?(n(),i("i",qt)):r("",!0),l.orderby=="stock"&&l.ordersort==""?(n(),i("i",Gt)):r("",!0),l.orderby=="stock"&&l.ordersort=="desc"?(n(),i("i",Ht)):r("",!0),l.orderby=="stock"&&l.ordersort=="asc"?(n(),i("i",Qt)):r("",!0)])])]),Wt,Xt,Yt])]),t("tbody",null,[(n(!0),i(R,null,S(O,(s,dt)=>(n(),i("tr",{class:_t({"bg-pink-50":_.indexOf(s.id)>=0,"bg-lime-100":h.indexOf(s.id)>=0})},[t("td",null,[p(V,{value:s.id,modelValue:a,"onUpdate:modelValue":o[9]||(o[9]=x=>a=x)},null,8,["value","modelValue"])]),t("td",null,c(Q(dt)),1),t("td",null,[k(t("img",{src:s.thumbFile,class:"w-28 h-28 object-cover"},null,8,Zt),[[rt]])]),t("td",null,c(s.title),1),t("td",null,c(s.category&&s.category.title||"/"),1),t("td",null,[(n(!0),i(R,null,S(s.metalInfo,(x,ct)=>(n(),i("div",null,c(x.title),1))),256))]),t("td",null,[(n(!0),i(R,null,S(s.stoneInfo,(x,ct)=>(n(),i("div",null,c(x.title),1))),256))]),t("td",null,"￥"+c(s.storeprice),1),t("td",null,"￥"+c(s.labelprice),1),t("td",null,c(s.stock),1),t("td",null,c(s.code),1),t("td",null,c(s.label),1),t("td",null,[P("edit")?(n(),i("button",{key:0,class:"btn btn-lan",onClick:x=>Y(s.id)},"编辑",8,te)):r("",!0)])],2))),256))])])]),t("div",ee,[t("div",oe,[k(p(V,{value:"all",modelValue:b,"onUpdate:modelValue":o[10]||(o[10]=s=>b=s)},null,8,["modelValue"]),[[C,"全选",void 0,{top:!0}]])]),t("div",null,[k((n(),i("button",{class:"btn btn-hong",onClick:o[11]||(o[11]=s=>tt(0))},[y("批量删除")])),[[C,"批量删除",void 0,{bottom:!0}]])]),t("div",null,[k((n(),i("button",{class:"btn btn-zi",onClick:o[12]||(o[12]=s=>et(0))},[y("加入打印")])),[[C,"加入打印标签",void 0,{bottom:!0}]])]),t("div",null,[k((n(),i("button",{class:"btn btn-lv",onClick:o[13]||(o[13]=s=>ot(0))},[y("添加到入库单")])),[[C,"添加到入库队列",void 0,{bottom:!0}]])]),d.pageCount>1?(n(),i("div",se,[p(g,{onTopage:W,pageData:d},null,8,["pageData"])])):r("",!0)])]),_:1})):r("",!0)}}};export{ae as default};
