import{u as Z,r as k,s as tt,a as $,w as R,g as L,p as et,o as ot,b as w,c as st,d as o,e as s,f as _,h as I,i as a,n as nt,j as m,k as U,t as C,l as h,m as V,F as x,q as M,P as at,v as q,x as lt,y,z as G,D as rt,A as dt}from"./index-ffc5c309.js";import S from"./form-a2a3aa59.js";const it=["innerHTML"],ut={class:"flex-1 flex flex-row-reverse space-x-reverse space-x-2"},ct={key:0,class:"absolute text-xs -top-1.5 -right-1.5 px-1 min-w-4 h-4 rounded-full bg-red-600 flex items-center justify-center"},pt=a("button",{class:"yp-button yp-button-red yp-button-sm rounded-sm",id:"ypimport"},"导入",-1),mt={class:"table-auto w-full text-sm"},yt={class:"bg-gray-100"},bt={class:"text-left"},vt={class:"px-2 py-2 border w-10 font-thin"},gt=a("th",{class:"px-2 py-2 border"},"ID",-1),_t={key:0,class:"px-2 py-2 border"},ht=a("th",{class:"px-2 py-2 border w-32 text-center"},"操作",-1),xt={class:"border px-2"},ft={class:"border px-2"},kt={key:0,class:"px-2 py-2 border"},wt={class:"border px-2 text-right"},Ct=["onClick"],Vt=["onClick"],Dt=["onClick"],$t=["onClick"],Rt={class:"border p-2"},Lt=["colspan"],It={key:0,class:"space-x-2"},Ut={key:1,class:"space-x-2"},Et={key:0,class:"mt-3"},Tt={__name:"index",setup(Bt){const O=Z(),d=O.meta;k({data:{}});const E=tt(""),B=$(""),N=$(0),f=$(!1),z=$("");R(z,(t,e)=>{t==""&&i()});const b=k({totalRecords:0,pageCount:0,currentPage:1}),J=t=>{b.currentPage=t,i()},r=k([]),v=k([]);R(v,(t,e)=>{r.length=0,t.length>0?l.list.forEach(g=>{r.push(g.id)}):r.length=0});const l=k({isremove:!1,removenum:0,list:[]});R(()=>O.params.categoryid,(t,e)=>{update(t)});const K=()=>{B.value="增加"+d.mod.alias,N.value=0,f.value=!0,E.value=S},Q=t=>{B.value="编辑"+d.mod.alias,N.value=t,f.value=!0,E.value=S},A=async(t=0)=>{if(t==0&&(t=r),!t){y({type:"alter-error",text:"请选择项目"});return}const e=await L("/article/delete",{ids:t});e.code&&(y({type:"alter-success",text:e.msg}),r.length=0,i())},F=t=>{if(t==0&&(t=r),!t){y({type:"alter-error",text:"请选择项目"});return}G({text:"确认删除吗？"}).then(async()=>{const e=await L("/article/delete",{ids:t});e.code&&(y({type:"alter-success",text:e.msg}),i())}).catch(e=>{})},H=async t=>{if(t==0){if(r.length==0){y({type:"alter-error",text:"请选择项目"});return}t=r}if(!t){y({type:"alter-error",text:"请选择项目"});return}const e=await L("/article/restore",{ids:t});e.code&&(y({type:"alter-success",text:e.msg}),r.length=0,i())};R(()=>l.isremove,(t,e)=>{i()});const W=()=>{if(r.length==0){y({type:"alter-error",text:"请选择项目"});return}G({text:"确定导出吗？"}).then(async()=>{const t=await rt("/article/export",{ids:r});let e=new Blob([t.data]),g=t.headers["content-disposition"],P=new RegExp("filename=([^;]+\\.[^\\.;]+);*").exec(g),T=decodeURI(P[1]),u=document.createElement("a"),c=window.URL.createObjectURL(e);u.style.display="none",u.href=c,u.download=T,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(c)}).catch(t=>{})},i=async()=>{l.list.length=0,r.length=0,v.length=0;const t=await L("/article/index",{isremove:l.isremove?1:0,page:l.curpage,keyword:z.value});t.code==1&&(l.removenum=t.data.removeNum,b.currentPage=t.data.current_page,b.pageCount=t.data.last_page,b.totalRecords=t.data.total,t.data.data.map(e=>{l.list.push(e)}))},X=t=>{const e=d.mod.name;return dt(e).indexOf(t)>=0};return et("formEvent",{saveEvent:()=>{i()}}),ot(async()=>{await i()}),(t,e)=>{const g=w("ypimport"),D=w("ypcheckbox"),P=w("yppage"),T=w("yplayout"),u=w("ypdialog"),c=st("tooltip");return o(),s(x,null,[_(T,null,{header:I(()=>[a("i",{class:nt(["ri-2x text-gray-500 ml-2",m(d).icon||"ri-information-line"])},null,2),a("div",{class:"text-xl px-3",innerHTML:m(d).title},null,8,it),a("div",ut,[a("button",{class:"yp-button yp-button-gray yp-button-sm rounded-sm relative",onClick:e[0]||(e[0]=n=>l.isremove=!l.isremove)},[U(C(l.isremove?"返回列表":"回收站")+" ",1),l.removenum?(o(),s("div",ct,C(l.removenum),1)):h("",!0)]),a("button",{class:"yp-button yp-button-orange yp-button-sm rounded-sm",onClick:W},"导出"),_(g,{url:"/admin.php/upload",ref:"uploader",mod:m(d).mod},{default:I(()=>[pt]),_:1},8,["mod"]),X("add")?(o(),s("button",{key:0,class:"yp-button yp-button-sm rounded-sm",onClick:K},"增加")):h("",!0)])]),list:I(()=>[a("table",mt,[a("thead",yt,[a("tr",bt,[a("th",vt,[V(_(D,{value:"all",modelValue:v,"onUpdate:modelValue":e[1]||(e[1]=n=>v=n)},null,8,["modelValue"]),[[c,"全选",void 0,{top:!0}]])]),gt,(o(!0),s(x,null,M(m(d).mod.modcolumn,(n,j)=>(o(),s(x,{key:j},[parseInt(n.colwidth)?(o(),s("th",_t,C(n.alias),1)):h("",!0)],64))),128)),ht])]),a("tbody",null,[(o(!0),s(x,null,M(l.list,(n,j)=>(o(),s("tr",{class:"hover:bg-gray-100",key:j},[a("td",xt,[_(D,{value:n.id,modelValue:r,"onUpdate:modelValue":e[2]||(e[2]=p=>r=p)},null,8,["value","modelValue"])]),a("td",ft,C(n.id),1),(o(!0),s(x,null,M(m(d).mod.modcolumn,(p,Y)=>(o(),s(x,{key:Y},[parseInt(p.colwidth)?(o(),s("td",kt,C(m(at)(p,n)),1)):h("",!0)],64))),128)),a("td",wt,[l.isremove?(o(),s("button",{key:0,class:"yp-button yp-button-sm yp-button-green rounded-sm mr-2",onClick:p=>H(n.id)},"还原",8,Ct)):(o(),s("button",{key:1,class:"yp-button yp-button-sm rounded-sm mr-2",onClick:p=>Q(n.id)},"编辑",8,Vt)),l.isremove?(o(),s("button",{key:2,class:"yp-button yp-button-red yp-button-sm rounded-sm",onClick:p=>F(n.id)},"删除",8,Dt)):(o(),s("button",{key:3,class:"yp-button yp-button-orange yp-button-sm rounded-sm",onClick:p=>A(n.id)},"回收站",8,$t))])]))),128))]),a("tfoot",null,[a("tr",null,[a("td",Rt,[V(_(D,{value:"all",modelValue:v,"onUpdate:modelValue":e[3]||(e[3]=n=>v=n)},null,8,["modelValue"]),[[c,"全选",void 0,{right:!0}]])]),a("td",{class:"border p-2",colspan:m(d).mod.modcolumn.length-1},[l.isremove?(o(),s("div",It,[V((o(),s("button",{class:"yp-button yp-button-sm yp-button-green rounded-sm",onClick:e[4]||(e[4]=n=>H(0))},[U("批量还原")])),[[c,"批量还原",void 0,{bottom:!0}]]),V((o(),s("button",{class:"yp-button yp-button-red yp-button-sm rounded-sm",onClick:e[5]||(e[5]=n=>F(0))},[U("批量删除")])),[[c,"批量删除",void 0,{bottom:!0}]])])):(o(),s("div",Ut,[V((o(),s("button",{class:"yp-button yp-button-sm yp-button-orange rounded-sm",onClick:e[6]||(e[6]=n=>A(0))},[U("批量移入回收站")])),[[c,"批量移入回收站",void 0,{bottom:!0}]])]))],8,Lt)])])]),b.pageCount>1?(o(),s("div",Et,[_(P,{onTopage:J,pageData:b},null,8,["pageData"])])):h("",!0)]),_:1}),f.value?(o(),q(u,{key:0,width:"1200",title:B.value,mask:1,onClose:e[8]||(e[8]=n=>f.value=!1)},{default:I(()=>[(o(),q(lt(E.value),{id:N.value,mod:m(d).mod,onClose:e[7]||(e[7]=n=>f.value=!1),onGetList:i},null,40,["id","mod"]))]),_:1},8,["title"])):h("",!0)],64)}}};export{Tt as default};
