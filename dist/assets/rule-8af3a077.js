import x from"./ruleItem-fd3eefa3.js";import{r as u,p as E,w as k,o as v,d as p,e as I,F as S,q as _,v as y}from"./index-0f467f6d.js";import"./ckbox-81e5dca3.js";let e={dataList:{},checkedIds:[],oneList:{},id:0,update:s=>(e.id=s,e.eachTree(e.dataList),e.checkedIds.indexOf(s)>=0?e.del(s):e.add(s),e.checkedIds),add:s=>{e.checkedIds.push(s);let t=e.getParent(s);e.oneList[s].children&&e.oneList[s].children.length&&e.getSon(e.oneList[s].children).forEach(h=>{e.checkedIds.push(h)}),t.length&&t.forEach(d=>{e.checkedIds.indexOf(d)<0&&e.checkedIds.push(d)})},del:s=>{e.checkedIds.splice(e.checkedIds.indexOf(s),1);let t=e.oneList[s].pid,d=!1;if(t){let h=e.getSon(e.oneList[t].children);e.checkedIds.forEach(a=>{h.indexOf(a)>=0&&(d=!0)})}if(!d){let h=e.getParent(s);h.length&&h.forEach(a=>{e.checkedIds.indexOf(a)>=0&&e.checkedIds.splice(e.checkedIds.indexOf(a),1)})}e.oneList[s].children&&e.oneList[s].children.length&&e.getSon(e.oneList[s].children).forEach(a=>{e.checkedIds.indexOf(a)>=0&&e.checkedIds.splice(e.checkedIds.indexOf(a),1)})},eachTree:s=>{s.forEach(t=>{t.id&&(e.oneList[t.id]=t),t.children&&t.children.length&&e.eachTree(t.children)})},getSon:s=>{let t=[];return s.forEach(d=>{t.push(d.id),d.children&&d.children.length&&e.getSon(d.children)}),t},getParent:s=>{let t=e.oneList[s].pid,d=[];return t&&(d.push(t),e.getParent(t)),d}};const J={class:"authrule"},T={__name:"rule",props:{dataList:{default:[]},value:Array},emits:["change"],setup(s,{emit:t}){const d=s,h=t,a=u(d.value),O=u([]),l=u([]),g=c=>{c.forEach(i=>{l.indexOf(i.id)>=0&&l.splice(l.indexOf(i.id),1),i.children&&i.children.length>0&&g(i.children)})},L=(c,i)=>{i.forEach(n=>{c==n.id?(l.splice(l.indexOf(c),1),n.children&&n.children.length>0&&g(n.children)):n.children&&n.children.length>0&&L(c,n.children)})};E("menu-switch",{opens:l,chitem:a,auth_btn:O,toggle:c=>{l.indexOf(c)>=0?L(c,d.dataList):l.push(c)},checked:c=>{let i=e.update(c);a.length=0,i.forEach(n=>{a.push(n)})}});const f=(c,i)=>{c&&i&&i.forEach(n=>{let r=!0;n.id==c&&(a.value=n,n.pid&&o(n.pid,d.dataList),r=!1),n.children&&r&&f(c,n.children)})},o=(c,i)=>{c&&i.forEach(n=>{let r=!0;n.id==c&&(l.push(c),o(n.pid,d.dataList),r=!1),n.children&&r&&o(c,n.children)})};return k(d,c=>{e.dataList=c.dataList,e.checkedIds=JSON.parse(JSON.stringify(c.value)),f(c.value,c.dataList)}),k(a,c=>{h("change",c)}),v(()=>{f(d.value,d.dataList),e.dataList=d.dataList,e.checkedIds=JSON.parse(JSON.stringify(d.value))}),(c,i)=>(p(),I("div",J,[(p(!0),I(S,null,_(s.dataList,(n,r)=>(p(),y(x,{list:n,key:r,leave:0},null,8,["list"]))),128))]))}};export{T as default};
