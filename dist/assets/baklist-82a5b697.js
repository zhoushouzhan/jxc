import{r as k,B as F,o as M,g as C,d as b,e as v,i as e,t as d,j as N,F as L,q as V,n as z,a as D,m as U,R as I,E as $,y as u,w as G,b as H,f as E,S as R,c as K,k as Y,D as Z}from"./index-0f467f6d.js";const A={class:"bg-white m-2 p-2"},J={class:"p-3 text-lg uppercase"},W=e("div",{class:"flex p-2 font-bold border-t text-sm"},[e("div",{class:"w-44 px-2"},"字段名"),e("div",{class:"w-44 px-2"},"类型"),e("div",{class:"w-44 px-2"},"注释")],-1),X={class:"w-44 px-2"},ee={class:"w-44 px-2"},te={class:"w-44 px-2 text-lime-700"},P={__name:"viewcol",emits:["jumpCom"],setup(S,{emit:h}){const c=k([]),i=F("getTb"),g=h,x=()=>{g("jumpCom",{to:j,item:[]})};return M(()=>{C("/database/column",{tables:i.item.data.name}).then(m=>{m.data.map(_=>{c.push(_)})})}),(m,_)=>(b(),v("div",A,[e("div",J,d(N(i).item.data.name),1),W,(b(!0),v(L,null,V(c,(r,n)=>(b(),v("div",{class:z(["flex p-2 border-t text-sm hover:bg-blue-50",{"bg-gray-100":n%2}]),key:n},[e("div",X,d(r.column_name),1),e("div",ee,d(r.column_type),1),e("div",te,d(r.column_comment),1)],2))),128)),e("div",{class:"p-3 text-center border-t"},[e("button",{class:"yp-button yp-button-red rounded-sm",onClick:x},"返回")])]))}},Oe=Object.freeze(Object.defineProperty({__proto__:null,default:P},Symbol.toStringTag,{value:"Module"})),se={class:"bg-white m-2"},oe={class:"flex space-x-2 border-b items-center text-sm"},re={class:"p-3"},ae=e("div",{class:"p-3 text-sm divide-y text-gray-500"},[e("div",{class:"py-1"},'1、数据表前缀可用：" [!pre!] "表示'),e("div",{class:"py-1"},"2、执行SQL语句关系重大，请做好备份。")],-1),O={__name:"dosql",emits:["jumpCom"],setup(S,{emit:h}){const c=h,i=()=>{c("jumpCom",{to:j,item:[]})},g=()=>{c("jumpCom",{to:T})},x=D(""),m=D(null),_=n=>{m.value.style.height="auto";const l=m.value.scrollHeight;l&&l>54&&(m.value.style.height=l+"px")},r=()=>{$("/database/dosql",{query:x.value}).then(n=>{n.code==1?u({type:"alter-success",text:n.msg}):u({type:"alter-error",text:n.msg})})};return(n,l)=>(b(),v("div",se,[e("div",oe,[e("div",{class:"p-2 cursor-pointer border-b-2 border-white hover:border-gray-400 duration-300",onClick:i},"数据表"),e("div",{class:"p-2 cursor-pointer border-b-2 border-white hover:border-gray-400 duration-300",onClick:g},"备份列表"),e("div",{class:"border-b-2 border-gray-800 p-2 duration-300",onClick:l[0]||(l[0]=(...y)=>n.dosql&&n.dosql(...y))},"执行SQL")]),e("div",re,[U(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=y=>x.value=y),class:"yp-textarea",onInput:l[2]||(l[2]=y=>_()),ref_key:"yptextarea",ref:m,placeholder:"请输入SQL语句，关系重大，请谨慎操作。"},null,544),[[I,x.value]])]),e("div",{class:"p-3"},[e("button",{class:"yp-button yp-button-red rounded-sm",onClick:r},"运行")]),ae]))}},Te=Object.freeze(Object.defineProperty({__proto__:null,default:O},Symbol.toStringTag,{value:"Module"})),ne={class:"bg-white m-2"},le=e("div",{class:"border-b-2 border-gray-800 p-2 duration-300"},"数据表",-1),de={class:"mt-2 p-2 text-sm"},ce={class:"flex border-b bg-gray-100 leading-8"},ie={class:"flex items-center px-2 border-r font-normal"},pe=R('<div class="w-32 border-r px-2">表名</div><div class="w-32 border-r px-2">行数</div><div class="w-40 border-r px-2">大小</div><div class="w-32 border-r px-2">冗余</div><div class="flex-1 text-left px-2 border-r">备注</div><div class="w-28 text-center">操作</div>',6),ue={class:"flex items-center px-2 border-r py-4"},me={class:"w-32 border-r px-2 text-gray-500 flex items-center"},be={class:"w-32 border-r px-2 text-gray-500 flex items-center"},ve={class:"w-40 border-r px-2 text-gray-500 flex items-center text-sm"},_e={class:"w-32 border-r px-2 text-gray-500 flex items-center"},xe={class:"flex-1 text-gray-500 flex items-center px-2 border-r text-sm"},ye={class:"w-28 text-center space-x-2 px-2 flex items-center justify-center"},he=["onClick"],j={__name:"list",emits:["jumpCom"],setup(S,{emit:h}){const c=h,i=k([]),g=t=>{c("jumpCom",{to:P,item:t})},x=()=>{c("jumpCom",{to:T})},m=()=>{c("jumpCom",{to:O})},_=k([]);G(_,(t,s)=>{t.length>0?(r.length=0,i.forEach(a=>{r.push(a.name)})):r.length=0});const r=k([]),n=(t,s=2)=>{if(t==0)return"0 Bytes";let a=1e3,o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],p=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,p)).toFixed(s))+" "+o[p]},l=async()=>{const t=await $("/database/export",{tables:r});t.code==1?u({type:"alter-success",text:t.msg}):u({type:"alter-error",text:t.msg})},y=async()=>{const t=await $("/database/optimize",{tables:r});t.code==1?u({type:"alter-success",text:t.msg}):u({type:"alter-error",text:t.msg})},B=async()=>{const t=await $("/database/repair",{tables:r});t.code==1?u({type:"alter-success",text:t.msg}):u({type:"alter-error",text:t.msg})};return M(async()=>{const t=await C("/database");t.code==1&&(i.length=0,t.data.map((s,a)=>{i.push(s)}))}),(t,s)=>{const a=H("ypcheckbox");return b(),v("div",ne,[e("div",{class:"flex space-x-2 border-b items-center text-sm"},[le,e("div",{class:"p-2 cursor-pointer border-b-2 border-white hover:border-gray-400 duration-300",onClick:x},"备份列表"),e("div",{class:"p-2 cursor-pointer border-b-2 border-white hover:border-gray-400 duration-300",onClick:m},"执行SQL")]),e("div",de,[e("div",ce,[e("div",ie,[E(a,{value:"all",modelValue:_,"onUpdate:modelValue":s[0]||(s[0]=o=>_=o)},null,8,["modelValue"])]),pe]),(b(!0),v(L,null,V(i,(o,p)=>(b(),v("div",{class:z(["flex hover:bg-blue-50 leading-10",{"bg-gray-100":p%2}]),key:p},[e("div",ue,[E(a,{value:o.name,modelValue:r,"onUpdate:modelValue":s[1]||(s[1]=f=>r=f)},null,8,["value","modelValue"])]),e("div",me,d(o.name),1),e("div",be,d(o.rows),1),e("div",ve,d(n(o.data_length)),1),e("div",_e,d(o.data_free),1),e("div",xe,d(o.comment),1),e("div",ye,[e("div",null,[e("button",{class:"yp-button yp-button-sm yp-button-gray rounded-sm",onClick:f=>g(o)},"查看字段",8,he)])])],2))),128)),e("div",{class:"mt-3 p-2 border-t"},[e("button",{class:"yp-button yp-button-orange rounded-sm",onClick:l},"备份"),e("button",{class:"yp-button yp-button-green rounded-sm mx-3",onClick:B},"修复"),e("button",{class:"yp-button yp-button-pink rounded-sm",onClick:y},"优化")])])])}}},qe=Object.freeze(Object.defineProperty({__proto__:null,default:j},Symbol.toStringTag,{value:"Module"})),ge={class:"bg-white m-2"},fe=e("div",{class:"border-b-2 border-gray-800 p-2 duration-300"},"备份列表",-1),we={class:"m-3 border-b"},ke=R('<div class="flex p-2 font-bold mt-3 bg-gray-200"><div class="w-52 px-2">备份文件</div><div class="w-44 px-2">文件数</div><div class="w-44 px-2">压缩格式</div><div class="w-44 px-2">数据大小</div><div class="w-44 px-2 flex-1">创建时间</div><div class="w-36 px-2 text-center">操作</div></div>',1),Ce=["onClick"],je={class:"w-44 px-2 flex items-center border-r"},Be={class:"w-44 px-2 flex items-center"},$e={class:"w-44 px-2 flex items-center"},Se={class:"w-44 px-2 flex-1 flex items-center"},Me={class:"w-36 px-2 flex items-center justify-center"},Le=["onClick"],Ve=["onClick"],T={__name:"baklist",emits:["jumpCom"],setup(S,{emit:h}){const c=k([]);F("getTb");const i=h,g=()=>{i("jumpCom",{to:j,item:[]})},x=()=>{i("jumpCom",{to:j,item:[]})},m=()=>{i("jumpCom",{to:O})},_=t=>t%2?"bg-gray-100":"",r=(t,s=2)=>{if(t==0)return"0 Bytes";let a=1e3,o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],p=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,p)).toFixed(s))+" "+o[p]},n=async t=>{const s=await C("/database/delete",{name:t});s.code==1?(u({type:"alter-success",text:s.msg}),B()):u({type:"alter-error",text:s.msg})},l=async t=>{const s=await C("/database/import",{name:t});s.code==1?u({type:"alter-success",text:s.msg}):u({type:"alter-error",text:s.msg})},y=async t=>{Z("/database/download",{name:t}).then(s=>{let a=new Blob([s.data]),o=s.headers["content-disposition"],f=new RegExp("filename=([^;]+\\.[^\\.;]+);*").exec(o),Q=decodeURI(f[1]),w=document.createElement("a"),q=window.URL.createObjectURL(a);w.style.display="none",w.href=q,w.download=Q,document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(q)})},B=async()=>{c.length=0,C("/database/importList").then(t=>{t.data.map(s=>{c.push(s)})})};return M(()=>{B()}),(t,s)=>{const a=K("tooltip");return b(),v("div",ge,[e("div",{class:"flex space-x-2 border-b items-center text-sm"},[e("div",{class:"p-2 cursor-pointer border-b-2 border-white hover:border-gray-400 duration-300",onClick:x},"数据表"),fe,e("div",{class:"p-2 cursor-pointer border-b-2 border-white hover:border-gray-400 duration-300",onClick:m},"执行SQL")]),e("div",we,[ke,(b(!0),v(L,null,V(c,(o,p)=>(b(),v("div",{class:z(["flex space-x-3 p-2 border-t text-sm hover:bg-green-50",_(p)]),key:p},[U((b(),v("div",{class:"w-52 px-2 flex items-center border-r cursor-pointer",onClick:f=>y(o.name)},[Y(d(o.filename),1)],8,Ce)),[[a,"下载备份文件",void 0,{bottom:!0}]]),e("div",je,d(o.part),1),e("div",Be,d(o.compress),1),e("div",$e,d(r(o.size)),1),e("div",Se,d(o.nameDate),1),e("div",Me,[e("button",{class:"yp-button yp-button-blue yp-button-sm rounded-sm mr-2",onClick:f=>l(o.name)},"还原",8,Le),e("button",{class:"yp-button yp-button-red yp-button-sm rounded-sm",onClick:f=>n(o.name)},"删除",8,Ve)])],2))),128))]),e("div",{class:"p-3 text-center"},[e("button",{class:"yp-button yp-button-red rounded-sm",onClick:g},"返回")])])}}},De=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));export{j as _,De as b,Te as d,qe as l,Oe as v};
