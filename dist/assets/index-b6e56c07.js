import{a as b,r as f,p as A,g as G,o as J,b as v,d as o,e as l,i as e,f as m,h as K,k as N,t as k,F as O,q as D,n as F,l as c,m as V,I as z,S as Q,y as u,z as L,E as j}from"./index-0f467f6d.js";const W={key:0,class:"bg-white m-2"},X={class:"flex space-x-2 p-2 border-b items-center"},Y=e("button",{class:"rounded-sm bg-gray-600 flex items-center py-1.5 px-3 text-white text-xs hover:bg-red-700",id:"ypupload"},[e("i",{class:"ri-upload-cloud-line ri-lg pr-1"}),N("选择上传 ")],-1),Z=e("i",{class:"ri-delete-bin-6-line ri-lg pr-1"},null,-1),ee={class:"hidden md:block"},te=e("i",{class:"ri-search-line ri-lg"},null,-1),se=[te],oe=e("div",{class:"flex-1"},null,-1),le={class:"flex items-center text-sm"},ie=e("div",{class:"bg-gray-500 border border-gray-500 py-1 px-2 text-white"},"总量",-1),ne={class:"border border-gray-500 py-1 px-3"},ae={class:"flex flex-row"},re=Q('<div class="w-20 md:w-40 min-h-[500px] border-r text-center text-xs md:text-sm transition duration-150 hidden"><div class="py-1 border-b bg-gray-600 text-white">文件</div><div class="py-1 border-b">图片</div><div class="py-1 border-b">文本</div><div class="py-1 border-b">其他</div></div>',1),de={class:"flex-1 p-2"},ce={key:0,class:"grid grid-cols-10 gap-1 mb-3"},ue=["src","title"],pe={key:1,class:"absolute top-0 left-1/2 -translate-x-1/2 text-pink-800"},_e=e("i",{class:"ri-folder-zip-line ri-2x"},null,-1),xe=[_e],he={key:2,class:"absolute top-0 left-1/2 -translate-x-1/2 text-blue-700"},fe=e("i",{class:"ri-file-word-2-line ri-2x"},null,-1),ye=[fe],ge={key:3,class:"absolute top-0 left-1/2 -translate-x-1/2 text-green-700"},be=e("i",{class:"ri-file-excel-2-line ri-2x"},null,-1),ve=[be],me={key:4,class:"absolute top-0 left-1/2 -translate-x-1/2 text-gray-600"},ke=e("i",{class:"ri-article-line ri-2x"},null,-1),we=[ke],Ce={key:5,class:"absolute top-0 left-1/2 -translate-x-1/2 text-red-600"},Oe=e("i",{class:"ri-file-pdf-line ri-2x"},null,-1),De=[Oe],Fe={key:6,class:"absolute top-0 left-1/2 -translate-x-1/2 text-purple-600"},Ve=e("i",{class:"ri-music-2-line ri-2x"},null,-1),ze=[Ve],Le={key:7,class:"absolute top-0 left-1/2 -translate-x-1/2 text-indigo-700"},je=e("i",{class:"ri-video-line ri-2x"},null,-1),Ne=[je],Se={key:8,class:"absolute top-0 left-1/2 -translate-x-1/2 text-pink-500"},Be=e("i",{class:"ri-file-line ri-2x"},null,-1),Pe=[Be],Re={class:"transition transform duration-300 text-xs truncate w-32 absolute bottom-0 text-center bg-white bg-opacity-80 py-1"},Ee=["onClick"],Ie=e("i",{class:"ri-close-circle-fill ri-lg"},null,-1),Te=[Ie],Ue={key:10,class:"w-1/3 h-1/3 bg-black text-white flex items-center justify-center rounded-full absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},$e={key:1,class:"mb-3"},qe={class:"grid grid-cols-2 md:grid-cols-10 gap-1"},He=["onClick"],Me=["src"],Ae={class:"-right-[36px] -bottom-[5px] absolute bg-blue-600 text-white w-[100px] h-[40px] flex items-center justify-center -rotate-45 z-40"},Ge=e("i",{class:"ri-check-line ri-lg rotate-45"},null,-1),Je=[Ge],Ke={class:"mt-6"},Qe={key:2,class:"mb-3 text-center py-2 border-t mt-2"},Xe={__name:"index",props:{selnum:{default:0},sids:{default:[]},isopen:{default:0}},emits:["useFiles"],setup(w,{emit:S}){const p=w,B=S,C=b(!1),r=f({totalRecords:0,pageCount:0,currentPage:1}),P=t=>{r.currentPage=t,d()},x=b(""),i=f([]),R=()=>{let t=h.filter((a,_)=>{if(i.indexOf(a.id)>=0)return!0});B("useFiles",t)},E=t=>{i.indexOf(t)>=0?i.splice(i.indexOf(t),1):p.selnum==0||i.length<p.selnum?i.push(t):u({type:"alter-error",text:"超出大最值"})},y=b(),I=()=>{y.value.onupload()},n=f([]);A("uploadHandle",{readyList:n,addFile:t=>{n.push(t)},removeFile:t=>{n.filter((a,_)=>{a.id==t&&n.splice(_,1)})},reload:()=>{d()}});const h=f([]),T=()=>{x.value==""?u({type:"alter-error",text:"关键词不能为空!"}):d()},d=async()=>{n.length=0,h.length=0;const t=await G("/files",{page:r.currentPage,keyword:x.value});t.code==1&&(r.totalRecords=t.data.total,r.pageCount=t.data.last_page,t.data.data.map((a,_)=>{h.push(a)}))},U=async()=>{L({text:"确认删除吗？"}).then(async()=>{const t=await j("/files/delete",{ids:i});t.code?(u({type:"alter-success",text:t.msg}),d()):u({type:"alter-error",text:t.msg})}).catch(t=>{})},$=()=>{L({text:"确认要清理吗？"}).then(async()=>{const t=await j("/files/clearfiles");t.code?(u({type:"alter-success",text:t.msg}),d()):u({type:"alter-error",text:t.msg})}).catch(t=>{})};return J(async()=>{await d(),p.sids&&Object.keys(p.sids).map(t=>{i.push(p.sids[t])}),C.value=!0}),(t,a)=>{const _=v("ypupload"),q=v("ypinput"),H=v("yppage");return C.value?(o(),l("div",W,[e("div",X,[e("div",null,[m(_,{ref_key:"uploader",ref:y},{default:K(()=>[Y]),_:1},512)]),e("div",{class:"flex-1 md:flex-none"},[e("button",{class:"rounded-sm bg-gray-600 flex items-center py-1.5 px-3 text-white text-xs hover:bg-red-700",onClick:U},[Z,N("删除 ")])]),e("div",ee,[m(q,{modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=s=>x.value=s),placeholder:"关键词"},null,8,["modelValue"])]),e("div",null,[e("button",{class:"rounded-sm bg-gray-600 flex items-center py-2 px-2 text-white text-xs hover:bg-red-700",onClick:T},se)]),oe,e("div",null,[e("button",{class:"rounded-sm bg-red-600 flex items-center py-1.5 px-3 text-white text-xs hover:bg-red-700",onClick:$}," 删除无效附件 ")]),e("div",le,[ie,e("div",ne,k(r.totalRecords),1)])]),e("div",ae,[re,e("div",de,[n.length?(o(),l("div",ce,[(o(!0),l(O,null,D(n,(s,g)=>(o(),l("div",{key:g,class:F(["w-32 h-32 overflow-hidden border relative group flex items-center",s.status==1?"border-gray-500":"border-red-500"])},[s.type.indexOf("image")>=0?(o(),l("img",{key:0,src:s.src,title:s.name},null,8,ue)):s.type.indexOf("zip")>=0?(o(),l("div",pe,xe)):s.type.indexOf("word")>=0?(o(),l("div",he,ye)):s.type.indexOf("sheet")>=0?(o(),l("div",ge,ve)):s.type.indexOf("text/plain")>=0?(o(),l("div",me,we)):s.type.indexOf("pdf")>=0?(o(),l("div",Ce,De)):s.type.indexOf("audio")>=0?(o(),l("div",Fe,ze)):s.type.indexOf("video")>=0?(o(),l("div",Le,Ne)):(o(),l("div",Se,Pe)),e("div",Re,k(s.name),1),s.status==0?(o(),l("div",{key:9,class:"w-5 h-5 absolute right-1 top-1 text-red-500 rounded-full bg-white flex justify-center items-center z-10",onClick:M=>y.value.removeFile(s.id)},Te,8,Ee)):c("",!0),s.status<2?(o(),l("div",Ue,k(s.progress)+"%",1)):c("",!0)],2))),128))])):c("",!0),n.length?(o(),l("div",$e,[e("button",{class:"yp-button yp-button-red rounded-sm",onClick:I},"开始上传")])):c("",!0),e("div",qe,[(o(!0),l(O,null,D(h,(s,g)=>(o(),l("div",{class:F(["w-28 md:w-32 h-28 md:h-32 flex items-center justify-center hover:bg-blue-500 hover:text-white transition duration-150 relative overflow-hidden",i.indexOf(s.id)>=0?"file_selected":"border"]),key:g,onClick:M=>E(s.id)},[e("img",{src:s.filepath},null,8,Me),V(e("div",Ae,Je,512),[[z,i.indexOf(s.id)>=0]])],10,He))),128))]),V(e("div",Ke,[m(H,{onTopage:P,pageData:r},null,8,["pageData"])],512),[[z,r.pageCount>1]]),i.length&&w.selnum?(o(),l("div",Qe,[e("button",{class:"yp-button rounded-sm",onClick:R},"确定")])):c("",!0)])])])):c("",!0)}}};export{Xe as default};
