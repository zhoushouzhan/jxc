import{u as at,a as dt,r as p,w as rt,o as it,g as I,b as V,c as ct,d as n,v as ut,h as F,i as t,t as c,e as d,k as h,l as r,f as y,j as pt,N as j,m as C,F as R,q as N,n as yt,y as k,z as J,E as mt,A as gt,D as K}from"./index-ffc5c309.js";import _t from"./linkage-60c1aaad.js";const bt={class:"flex items-center"},ht=t("i",{class:"ri-2x text-gray-500 ml-2 ri-product-hunt-line"},null,-1),vt={class:"text-xl px-2"},xt=t("div",{class:"text-gray-400"},null,-1),ft=t("div",{class:"flex-1"},null,-1),kt={class:"flex items-center space-x-3"},wt=t("i",{class:"ri-add-line ri-lg pr-1"},null,-1),Vt=t("i",{class:"ri-download-2-fill ri-lg pr-1"},null,-1),Ct=t("i",{class:"ri-upload-2-fill ri-lg pr-1"},null,-1),Lt=t("i",{class:"ri-barcode-line ri-lg pr-1"},null,-1),Ot={class:"flex items-center space-x-2"},Ut={class:"yp-table-datalist"},Dt=t("th",null,"序号",-1),It=t("th",null,"图片",-1),jt=t("th",null,"名称",-1),Rt=t("th",null,"类别",-1),Nt=t("th",null,"金属",-1),St=t("th",null,"原石",-1),$t={class:"flex items-center space-x-1"},Bt=t("div",null,"零售价",-1),Et={key:0,class:"ri-menu-line text-gray-500"},Tt={key:1,class:"ri-menu-line text-gray-500"},Pt={key:2,class:"ri-sort-desc text-gray-500"},Ft={key:3,class:"ri-sort-asc text-gray-500"},Jt=t("th",null,"标签价",-1),Kt={class:"flex items-center space-x-1"},zt=t("div",null,"库存",-1),At={key:0,class:"ri-menu-line text-gray-500"},qt={key:1,class:"ri-menu-line text-gray-500"},Mt={key:2,class:"ri-sort-desc text-gray-500"},Gt={key:3,class:"ri-sort-asc text-gray-500"},Ht=t("th",null,"条码",-1),Qt=t("th",null,"标签",-1),Wt=t("th",null,"操作",-1),Xt=["src","onClick"],Yt=["onClick"],Zt={class:"flex space-x-1 items-center"},te={class:"p-2"},ee={key:0},ne={__name:"list",props:{page:{default:0}},emits:["jumpTo"],setup(z,{emit:A}){const S=z,L=A,q=at().meta,$=dt(!1),M=p([]),i=p({pagelimit:30,totalRecords:0,pageCount:0,currentPage:S.page}),G=e=>i.totalRecords-(e+(i.currentPage-1)*i.pagelimit),H=e=>{l.page=e,i.currentPage=e,m()},a=p([]),v=p(JSON.parse(sessionStorage.getItem("printBarcode"))||[]),x=p(JSON.parse(sessionStorage.getItem("ingodownList"))||[]),f=p([]);rt(f,(e,o)=>{a.length=0,e.length>0?O.forEach(u=>{a.push(u.id)}):a.length=0});const l=p({orderby:"",ordersort:"",category_id:0,page:S.page,stone:0,code:"",keyword:"",label:"",godown:[]}),O=p([]),Q=e=>{window.open(e)},W=()=>{L("jumpTo",{to:"add",page:l.page})},X=e=>{L("jumpTo",{to:"edit",id:e,page:l.page})},Y=()=>{L("jumpTo",{to:"barcode"})},Z=async e=>{if(a.length==0){k({type:"alter-error",text:"请选择条目"});return}J({text:"确认删除吗？"}).then(async()=>{const o=await mt("goods/delete",{id:a});o.code==1&&(k({type:"alter-success",text:o.msg}),a.length=0,f.length=0,m())}).catch(o=>{})},tt=()=>{if(a.length==0){k({type:"alter-error",text:"请选择要打印的商品"});return}for(let e=0;e<a.length;e++)v.indexOf(a[e])<0?v.push(a[e]):v.splice(v.indexOf(a[e]),1);sessionStorage.setItem("printBarcode",JSON.stringify(v)),k({type:"alter-success",text:"己加入打印队列"})},et=()=>{if(a.length==0){k({type:"alter-error",text:"请选择要打印的商品"});return}for(let e=0;e<a.length;e++)x.indexOf(a[e])<0?x.push(a[e]):x.splice(x.indexOf(a[e]),1);sessionStorage.setItem("ingodownList",JSON.stringify(x)),k({type:"alter-success",text:"添加入库队列成功"})},m=async()=>{let e=await I("/goods",l);if(e.code==1){i.currentPage=e.data.current_page,i.pageCount=e.data.last_page,i.totalRecords=e.data.total,i.pagelimit=e.data.per_page,O.length=0;for(let o in e.data.data)O.push(e.data.data[o])}$.value=!0},ot=()=>{l.page=0,i.currentPage=0,m()},B=e=>{l.page=0,l.orderby=e,l.ordersort=l.ordersort=="desc"?"asc":"desc",m()},E=e=>{const o=q.mod.name;return gt(o).indexOf(e)>=0},st=async()=>{J({text:"确定导出吗？"}).then(async()=>{let e=[];a.length?e=await K("goods/export",{ids:a}):e=await K("goods/export",l);let o=new Blob([e.data]),u=e.headers["content-disposition"],w=new RegExp("filename=([^;]+\\.[^\\.;]+);*").exec(u),D=decodeURI(w[1]),g=document.createElement("a"),_=window.URL.createObjectURL(o);g.style.display="none",g.href=_,g.download=D,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(_)}).catch(e=>{console.log("no",e)})},T=p([]),lt=async()=>{const e=await I("/classify/index",{pid:3428});e.code==1&&Object.keys(e.data).map(o=>{T[o]={value:e.data[o].id,title:e.data[o].title}})};return it(async()=>{const e=await I("/godown/index");if(e.code==1){let o=e.data.data;Object.keys(o).map(u=>{M[u]=o[u]})}await lt(),await m(),document.addEventListener("click",()=>{})}),(e,o)=>{const u=V("ypselect"),U=V("ypinput"),w=V("ypcheckbox"),D=V("yppage"),g=V("yplayout"),_=ct("tooltip");return $.value?(n(),ut(g,{key:0},{header:F(s=>[t("div",bt,[ht,t("div",vt,c(s.meta.title),1),xt]),ft,t("div",kt,[E("add")?(n(),d("button",{key:0,class:"yp-button yp-button-red rounded py-2",type:"button",onClick:W},[wt,h(" 录入商品 ")])):r("",!0),t("button",{class:"yp-button yp-button-pink rounded",onClick:o[0]||(o[0]=P=>L("jumpTo",{to:"import"}))},[Vt,h(" 导入商品 ")]),t("button",{class:"yp-button yp-button-orange rounded",onClick:st},[Ct,h(" 导出 ")]),t("button",{class:"yp-button yp-button-black rounded",onClick:Y},[Lt,h(" 打印条码 ")])])]),list:F(()=>[t("div",Ot,[t("div",null,[y(pt(_t),{modelValue:l.category_id,"onUpdate:modelValue":o[1]||(o[1]=s=>l.category_id=s)},null,8,["modelValue"])]),t("div",null,[y(u,{modelValue:l.stone,"onUpdate:modelValue":o[2]||(o[2]=s=>l.stone=s),itemList:T},null,8,["modelValue","itemList"])]),t("div",null,[y(U,{modelValue:l.code,"onUpdate:modelValue":o[3]||(o[3]=s=>l.code=s),placeholder:"条码",onKeyup:j(m,["enter"])},null,8,["modelValue"])]),t("div",null,[y(U,{modelValue:l.keyword,"onUpdate:modelValue":o[4]||(o[4]=s=>l.keyword=s),placeholder:"名称关键词",onKeyup:j(m,["enter"])},null,8,["modelValue"])]),t("div",null,[y(U,{modelValue:l.label,"onUpdate:modelValue":o[5]||(o[5]=s=>l.label=s),placeholder:"标签",onKeyup:j(m,["enter"])},null,8,["modelValue"])]),t("div",null,[t("button",{class:"yp-button yp-button-sm yp-button-orange rounded",onClick:ot},"查询")])]),t("div",null,[t("table",Ut,[t("thead",null,[t("tr",null,[t("th",null,[C(y(w,{value:"all",modelValue:f,"onUpdate:modelValue":o[6]||(o[6]=s=>f=s)},null,8,["modelValue"]),[[_,"全选",void 0,{top:!0}]])]),Dt,It,jt,Rt,Nt,St,t("th",null,[t("div",$t,[Bt,t("div",{class:"cursor-pointer",onClick:o[7]||(o[7]=s=>B("storeprice"))},[l.orderby!="storeprice"?(n(),d("i",Et)):r("",!0),l.orderby=="storeprice"&&l.ordersort==""?(n(),d("i",Tt)):r("",!0),l.orderby=="storeprice"&&l.ordersort=="desc"?(n(),d("i",Pt)):r("",!0),l.orderby=="storeprice"&&l.ordersort=="asc"?(n(),d("i",Ft)):r("",!0)])])]),Jt,t("th",null,[t("div",Kt,[zt,t("div",{class:"cursor-pointer",onClick:o[8]||(o[8]=s=>B("stock"))},[l.orderby!="stock"?(n(),d("i",At)):r("",!0),l.orderby=="stock"&&l.ordersort==""?(n(),d("i",qt)):r("",!0),l.orderby=="stock"&&l.ordersort=="desc"?(n(),d("i",Mt)):r("",!0),l.orderby=="stock"&&l.ordersort=="asc"?(n(),d("i",Gt)):r("",!0)])])]),Ht,Qt,Wt])]),t("tbody",null,[(n(!0),d(R,null,N(O,(s,P)=>(n(),d("tr",{class:yt({"bg-pink-50":v.indexOf(s.id)>=0,"bg-lime-100":x.indexOf(s.id)>=0})},[t("td",null,[y(w,{value:s.id,modelValue:a,"onUpdate:modelValue":o[9]||(o[9]=b=>a=b)},null,8,["value","modelValue"])]),t("td",null,c(G(P)),1),t("td",null,[t("img",{src:s.thumbFile,class:"max-h-10",onClick:b=>Q(s.thumbFile)},null,8,Xt)]),t("td",null,c(s.title),1),t("td",null,c(s.category&&s.category.title||"/"),1),t("td",null,[(n(!0),d(R,null,N(s.metalInfo,(b,nt)=>(n(),d("div",null,c(b.title),1))),256))]),t("td",null,[(n(!0),d(R,null,N(s.stoneInfo,(b,nt)=>(n(),d("div",null,c(b.title),1))),256))]),t("td",null,"￥"+c(s.storeprice),1),t("td",null,"￥"+c(s.labelprice),1),t("td",null,c(s.stock),1),t("td",null,c(s.code),1),t("td",null,c(s.label),1),t("td",null,[E("edit")?(n(),d("button",{key:0,class:"yp-button yp-button-sm",onClick:b=>X(s.id)},"编辑",8,Yt)):r("",!0)])],2))),256))])])]),t("div",Zt,[t("div",te,[C(y(w,{value:"all",modelValue:f,"onUpdate:modelValue":o[10]||(o[10]=s=>f=s)},null,8,["modelValue"]),[[_,"全选",void 0,{top:!0}]])]),t("div",null,[C((n(),d("button",{class:"yp-button yp-button-red yp-button-sm rounded-sm",onClick:o[11]||(o[11]=s=>Z(0))},[h("批量删除")])),[[_,"批量删除",void 0,{bottom:!0}]])]),t("div",null,[C((n(),d("button",{class:"yp-button yp-button-sm rounded-sm",onClick:o[12]||(o[12]=s=>tt(0))},[h("加入打印")])),[[_,"加入打印标签",void 0,{bottom:!0}]])]),t("div",null,[C((n(),d("button",{class:"yp-button yp-button-sm yp-button-black rounded-sm",onClick:o[13]||(o[13]=s=>et(0))},[h("添加到入库单")])),[[_,"添加到入库队列",void 0,{bottom:!0}]])]),i.pageCount>1?(n(),d("div",ee,[y(D,{onTopage:H,pageData:i},null,8,["pageData"])])):r("",!0)])]),_:1})):r("",!0)}}};export{ne as default};
