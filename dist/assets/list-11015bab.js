import{u as dt,a as ct,r as u,w as ut,o as pt,g as D,b as f,c as gt,d as n,v as mt,h as F,i as t,t as c,f as g,N as R,e as r,k as h,l as i,m as L,F as T,q as N,n as yt,y as k,z as J,E as _t,A as ht,D as K}from"./index-0f467f6d.js";const bt={class:"flex items-center"},vt=t("i",{class:"ri-2x text-gray-500 ml-2 ri-product-hunt-line"},null,-1),xt={class:"text-xl px-2"},ft=t("div",{class:"text-gray-400"},null,-1),kt={class:"flex items-center space-x-2"},wt=t("div",{class:"flex-1"},null,-1),Vt={class:"flex items-center space-x-3"},Ct=t("i",{class:"ri-add-line ri-lg pr-1"},null,-1),Lt=t("i",{class:"ri-download-2-fill ri-lg pr-1"},null,-1),Ot=t("i",{class:"ri-upload-2-fill ri-lg pr-1"},null,-1),Ut=t("i",{class:"ri-barcode-line ri-lg pr-1"},null,-1),jt={class:"yp-table-datalist text-hui-300"},Dt=t("th",null,"序号",-1),It=t("th",{class:"w-28"},"图片",-1),Rt=t("th",null,"名称",-1),Tt=t("th",null,"类别",-1),Nt=t("th",null,"金属",-1),St=t("th",null,"原石",-1),Bt={class:"flex items-center space-x-1"},$t=t("div",null,"零售价",-1),Et={key:0,class:"ri-menu-line text-gray-500"},Pt={key:1,class:"ri-menu-line text-gray-500"},zt={key:2,class:"ri-sort-desc text-gray-500"},Ft={key:3,class:"ri-sort-asc text-gray-500"},Jt=t("th",null,"标签价",-1),Kt={class:"flex items-center space-x-1"},At=t("div",null,"库存",-1),qt={key:0,class:"ri-menu-line text-gray-500"},Mt={key:1,class:"ri-menu-line text-gray-500"},Gt={key:2,class:"ri-sort-desc text-gray-500"},Ht={key:3,class:"ri-sort-asc text-gray-500"},Qt=t("th",null,"条码",-1),Wt=t("th",null,"标签",-1),Xt=t("th",null,"操作",-1),Yt=["src","onClick"],Zt=["onClick"],te={class:"flex space-x-1 items-center"},ee={class:"p-2"},oe={key:0},ne={__name:"list",props:{page:{default:0}},emits:["jumpTo"],setup(A,{emit:q}){const S=A,O=q,M=dt().meta,B=ct(!1),G=u([]),d=u({pagelimit:30,totalRecords:0,pageCount:0,currentPage:S.page}),H=e=>d.totalRecords-(e+(d.currentPage-1)*d.pagelimit),Q=e=>{l.page=e,d.currentPage=e,m()},a=u([]),b=u(JSON.parse(sessionStorage.getItem("printBarcode"))||[]),v=u(JSON.parse(sessionStorage.getItem("ingodownList"))||[]),x=u([]);ut(x,(e,o)=>{a.length=0,e.length>0?U.forEach(p=>{a.push(p.id)}):a.length=0});const l=u({orderby:"",ordersort:"",category_id:0,page:S.page,stone:0,code:"",keyword:"",label:"",godown:[]}),U=u([]),W=e=>{window.open(e)},X=()=>{O("jumpTo",{to:"add",page:l.page})},Y=e=>{O("jumpTo",{to:"edit",id:e,page:l.page})},Z=()=>{O("jumpTo",{to:"barcode"})},tt=async e=>{if(a.length==0){k({type:"alter-error",text:"请选择条目"});return}J({text:"确认删除吗？"}).then(async()=>{const o=await _t("goods/delete",{id:a});o.code==1&&(k({type:"alter-success",text:o.msg}),a.length=0,x.length=0,m())}).catch(o=>{})},et=()=>{if(a.length==0){k({type:"alter-error",text:"请选择要打印的商品"});return}for(let e=0;e<a.length;e++)b.indexOf(a[e])<0?b.push(a[e]):b.splice(b.indexOf(a[e]),1);sessionStorage.setItem("printBarcode",JSON.stringify(b)),k({type:"alter-success",text:"己加入打印队列"})},ot=()=>{if(a.length==0){k({type:"alter-error",text:"请选择要打印的商品"});return}for(let e=0;e<a.length;e++)v.indexOf(a[e])<0?v.push(a[e]):v.splice(v.indexOf(a[e]),1);sessionStorage.setItem("ingodownList",JSON.stringify(v)),k({type:"alter-success",text:"添加入库队列成功"})},m=async()=>{let e=await D("/goods",l);if(e.code==1){d.currentPage=e.data.current_page,d.pageCount=e.data.last_page,d.totalRecords=e.data.total,d.pagelimit=e.data.per_page,U.length=0;for(let o in e.data.data)U.push(e.data.data[o])}B.value=!0},st=()=>{l.page=0,d.currentPage=0,m()},$=e=>{l.page=0,l.orderby=e,l.ordersort=l.ordersort=="desc"?"asc":"desc",m()},E=e=>{const o=M.mod.name;return ht(o).indexOf(e)>=0},lt=async()=>{J({text:"确定导出吗？"}).then(async()=>{let e=[];a.length?e=await K("goods/export",{ids:a}):e=await K("goods/export",l);let o=new Blob([e.data]),p=e.headers["content-disposition"],w=new RegExp("filename=([^;]+\\.[^\\.;]+);*").exec(p),V=decodeURI(w[1]),y=document.createElement("a"),j=window.URL.createObjectURL(o);y.style.display="none",y.href=j,y.download=V,document.body.appendChild(y),y.click(),document.body.removeChild(y),window.URL.revokeObjectURL(j)}).catch(e=>{console.log("no",e)})},P=u([]),nt=async()=>{const e=await D("/classify/index",{pid:3428});e.code==1&&Object.keys(e.data).map(o=>{P[o]={id:e.data[o].id,title:e.data[o].title}})},I=u([]),at=async()=>{const e=await D("category/readTree");e.code==1&&(I.length=0,Object.keys(e.data).map(o=>{I.push(e.data[o])}))};return pt(async()=>{const e=await D("/godown/index");if(e.code==1){let o=e.data.data;Object.keys(o).map(p=>{G[p]=o[p]})}await nt(),await m(),await at(),document.addEventListener("click",()=>{})}),(e,o)=>{const p=f("yptree"),z=f("ypselect"),w=f("ypinput"),V=f("ypcheckbox"),y=f("yppage"),j=f("yplayout"),C=gt("tooltip");return B.value?(n(),mt(j,{key:0},{header:F(s=>[t("div",bt,[vt,t("div",xt,c(s.meta.title),1),ft])]),list:F(()=>[t("div",kt,[t("div",null,[g(p,{modelValue:l.category_id,"onUpdate:modelValue":o[0]||(o[0]=s=>l.category_id=s),itemList:I,defaultTitle:"--选择栏目--"},null,8,["modelValue","itemList"])]),t("div",null,[g(z,{modelValue:l.stone,"onUpdate:modelValue":o[1]||(o[1]=s=>l.stone=s),itemList:P,defaultTitle:"--选择原石--"},null,8,["modelValue","itemList"])]),t("div",null,[g(w,{modelValue:l.code,"onUpdate:modelValue":o[2]||(o[2]=s=>l.code=s),placeholder:"条码",onKeyup:R(m,["enter"])},null,8,["modelValue"])]),t("div",null,[g(w,{modelValue:l.keyword,"onUpdate:modelValue":o[3]||(o[3]=s=>l.keyword=s),placeholder:"名称关键词",onKeyup:R(m,["enter"])},null,8,["modelValue"])]),t("div",null,[g(w,{modelValue:l.label,"onUpdate:modelValue":o[4]||(o[4]=s=>l.label=s),placeholder:"标签",onKeyup:R(m,["enter"])},null,8,["modelValue"])]),t("div",null,[t("button",{class:"btn btn-chen",onClick:st},"查询")]),wt,t("div",Vt,[E("add")?(n(),r("button",{key:0,class:"btn btn-hong",type:"button",onClick:X},[Ct,h(" 录入商品 ")])):i("",!0),t("button",{class:"btn btn-lan",onClick:o[5]||(o[5]=s=>O("jumpTo",{to:"import"}))},[Lt,h(" 导入商品 ")]),t("button",{class:"btn btn-lv",onClick:lt},[Ot,h(" 导出 ")]),t("button",{class:"btn btn-zi",onClick:Z},[Ut,h(" 打印条码 ")])])]),t("div",null,[t("table",jt,[t("thead",null,[t("tr",null,[t("th",null,[L(g(V,{value:"all",modelValue:x,"onUpdate:modelValue":o[6]||(o[6]=s=>x=s)},null,8,["modelValue"]),[[C,"全选",void 0,{top:!0}]])]),Dt,It,Rt,Tt,Nt,St,t("th",null,[t("div",Bt,[$t,t("div",{class:"cursor-pointer",onClick:o[7]||(o[7]=s=>$("storeprice"))},[l.orderby!="storeprice"?(n(),r("i",Et)):i("",!0),l.orderby=="storeprice"&&l.ordersort==""?(n(),r("i",Pt)):i("",!0),l.orderby=="storeprice"&&l.ordersort=="desc"?(n(),r("i",zt)):i("",!0),l.orderby=="storeprice"&&l.ordersort=="asc"?(n(),r("i",Ft)):i("",!0)])])]),Jt,t("th",null,[t("div",Kt,[At,t("div",{class:"cursor-pointer",onClick:o[8]||(o[8]=s=>$("stock"))},[l.orderby!="stock"?(n(),r("i",qt)):i("",!0),l.orderby=="stock"&&l.ordersort==""?(n(),r("i",Mt)):i("",!0),l.orderby=="stock"&&l.ordersort=="desc"?(n(),r("i",Gt)):i("",!0),l.orderby=="stock"&&l.ordersort=="asc"?(n(),r("i",Ht)):i("",!0)])])]),Qt,Wt,Xt])]),t("tbody",null,[(n(!0),r(T,null,N(U,(s,rt)=>(n(),r("tr",{class:yt({"bg-pink-50":b.indexOf(s.id)>=0,"bg-lime-100":v.indexOf(s.id)>=0})},[t("td",null,[g(V,{value:s.id,modelValue:a,"onUpdate:modelValue":o[9]||(o[9]=_=>a=_)},null,8,["value","modelValue"])]),t("td",null,c(H(rt)),1),t("td",null,[t("img",{src:s.thumbFile,class:"w-28 h-28 object-cover",onClick:_=>W(s.thumbFile)},null,8,Yt)]),t("td",null,c(s.title),1),t("td",null,c(s.category&&s.category.title||"/"),1),t("td",null,[(n(!0),r(T,null,N(s.metalInfo,(_,it)=>(n(),r("div",null,c(_.title),1))),256))]),t("td",null,[(n(!0),r(T,null,N(s.stoneInfo,(_,it)=>(n(),r("div",null,c(_.title),1))),256))]),t("td",null,"￥"+c(s.storeprice),1),t("td",null,"￥"+c(s.labelprice),1),t("td",null,c(s.stock),1),t("td",null,c(s.code),1),t("td",null,c(s.label),1),t("td",null,[E("edit")?(n(),r("button",{key:0,class:"btn btn-lan",onClick:_=>Y(s.id)},"编辑",8,Zt)):i("",!0)])],2))),256))])])]),t("div",te,[t("div",ee,[L(g(V,{value:"all",modelValue:x,"onUpdate:modelValue":o[10]||(o[10]=s=>x=s)},null,8,["modelValue"]),[[C,"全选",void 0,{top:!0}]])]),t("div",null,[L((n(),r("button",{class:"btn btn-hong",onClick:o[11]||(o[11]=s=>tt(0))},[h("批量删除")])),[[C,"批量删除",void 0,{bottom:!0}]])]),t("div",null,[L((n(),r("button",{class:"btn btn-zi",onClick:o[12]||(o[12]=s=>et(0))},[h("加入打印")])),[[C,"加入打印标签",void 0,{bottom:!0}]])]),t("div",null,[L((n(),r("button",{class:"btn btn-lv",onClick:o[13]||(o[13]=s=>ot(0))},[h("添加到入库单")])),[[C,"添加到入库队列",void 0,{bottom:!0}]])]),d.pageCount>1?(n(),r("div",oe,[g(y,{onTopage:Q,pageData:d},null,8,["pageData"])])):i("",!0)])]),_:1})):i("",!0)}}};export{ne as default};
