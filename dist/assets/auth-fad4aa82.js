import{a as v,r as d,o as j,M as f,g as h,b as B,d as r,e as i,i as t,n as b,m as k,I as w,f as I,j as F,F as C,q as E,t as $,l as A,E as M,y as R}from"./index-169137c2.js";import T from"./rule-a9f7c26a.js";import"./ruleItem-90a0b0db.js";import"./ckbox-dee04004.js";const q={key:0},z={class:"flex space-x-3 border-b py-3"},G={class:"text-sm"},H={class:"w-40"},J={class:"flex-1 flex items-center flex-wrap space-x-4 pl-3"},K={class:"grid grid-cols-8"},Y={__name:"auth",props:{rolesId:0},emits:["close"],setup(V,{emit:L}){const _=v(!1),u=V,S=L,x=v(""),y=d([]),p=d([]),n=v(0),g=d([]),l=d({}),D=async()=>{const a=await M("/roles/authupdate",{id:u.rolesId,rules:p,modbtn:l});if(a.code==1){R({type:"alter-success",text:a.msg});const s=await f.dispatch("Sys/getSys");f.dispatch("User/GET_USER_INFO",s.admin),setTimeout(S("close"),1e3)}},N=a=>{p.length=0,a.length&&a.forEach(s=>{p.push(s)})};return j(async()=>{const a=f.getters.actions,s=await h("/mod/index");s.code==1&&s.data.forEach(e=>{let o=[];Object.keys(a).map(c=>{e.actions.indexOf(c)>=0&&o.push(a[c])}),e.actions.length=0,e.actions=o,l[e.name]=[],g.push(e)});const m=await h("/rule/index");if(x.value=m.data,u.rolesId){const e=await h("/roles/getroles",{id:u.rolesId});e.code==1&&(e.data.rules&&e.data.rules.length&&e.data.rules.forEach(o=>{y.push(parseInt(o))}),Object.keys(e.data.modbtn).map(o=>{l[o]=e.data.modbtn[o]}))}_.value=!0}),(a,s)=>{const m=B("ypcheckbox");return _.value?(r(),i("div",q,[t("div",z,[t("div",{class:b(["cursor-pointer",{"text-red-500":n.value==0}]),onClick:s[0]||(s[0]=e=>n.value=0)},"菜单",2),t("div",{class:b(["cursor-pointer",{"text-red-500":n.value==1}]),onClick:s[1]||(s[1]=e=>n.value=1)},"模型",2)]),t("div",null,[k(t("div",null,[I(F(T),{dataList:x.value,value:y,onChange:N},null,8,["dataList","value"])],512),[[w,n.value==0]]),k(t("div",G,[(r(!0),i(C,null,E(g,(e,o)=>(r(),i("div",{class:"flex border-b py-2",key:o},[t("div",H,$(e.alias),1),t("div",J,[t("div",K,[(r(!0),i(C,null,E(e.actions,(c,O)=>(r(),i("div",{key:O},[I(m,{value:c.name,title:c.title,modelValue:l[e.name],"onUpdate:modelValue":U=>l[e.name]=U},null,8,["value","title","modelValue","onUpdate:modelValue"])]))),128))])])]))),128))],512),[[w,n.value==1]])]),t("div",{class:"mt-5 text-center"},[t("button",{class:"yp-button yp-button-red rounded",onClick:D},"保存")])])):A("",!0)}}};export{Y as default};
