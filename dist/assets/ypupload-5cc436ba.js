import{L as p,o as l,y as u,d as c,e as m,a3 as y,B as f}from"./index-ddd32adc.js";import{p as _}from"./plupload.full.min-99e67f14.js";const b={id:"plupload"},z={__name:"ypupload",emits:["getlist"],setup(x,{expose:n,emit:L}){const d=f("uploadHandle"),t=new _.Uploader({url:"/index/upload",headers:{Authorization:p.state.User.token,"x-requested-with":"XMLHttpRequest"}});return n({onupload:()=>{t.start()},removeFile:s=>{t.removeFile(s),d.removeFile(s)}}),l(()=>{t.setOption("browse_button","ypupload"),t.setOption("filters",{mime_types:[{title:"Files",extensions:p.state.Sys.sysinfo.filetype}],max_file_size:p.state.Sys.sysinfo.uploadsize+"mb",prevent_duplicates:!0}),t.init(),t.bind("FilesAdded",(s,i)=>{i.map((e,a)=>{let r="";e.type.indexOf("application")<0&&(r=URL.createObjectURL(e.getNative()));let o={};o.id=e.id,o.name=e.name,o.type=e.type,o.size=parseInt(e.origSize/1024/1024*100)/100,o.progress=0,o.status=0,o.src=r,d.addFile(o)})}),t.bind("BeforeUpload",(s,i)=>{d.readyList=d.readyList.map((e,a)=>(e.id==i.id&&(e.status=1),e))}),t.bind("UploadProgress",(s,i)=>{d.readyList=d.readyList.map((e,a)=>(e.id==i.id&&(e.progress=i.percent),e))}),t.bind("FileUploaded",(s,i,e)=>{let a=JSON.parse(e.response);d.readyList=d.readyList.map((r,o)=>(r.id==i.id&&(a.code==1?(r.status=2,r.src=a.data.url):r.status=3),r))}),t.bind("UploadComplete",(s,i)=>{u({type:"alter-success",text:"上传完毕"}),s.splice(),d.reload()}),t.bind("FilesAdded",(s,i)=>{}),t.bind("Error",(s,i)=>{})}),(s,i)=>(c(),m("div",b,[y(s.$slots,"default")]))}};export{z as default};
